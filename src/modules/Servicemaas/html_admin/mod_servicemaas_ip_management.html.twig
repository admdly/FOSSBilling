{% extends request.ajax ? 'layout_blank.html.twig' : 'layout_default.html.twig' %}

{% block meta_title %}{{ 'MAAS IP Management'|trans }}{% endblock %}

{% set active_menu = 'maas' %}

{% block breadcrumbs %}
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="{{ '/'|alink }}">
                <svg class="icon">
                    <use xlink:href="#home" />
                </svg>
            </a>
        </li>
        <li class="breadcrumb-item">
            <a href="{{ 'servicemaas'|alink }}">{{ 'MAAS'|trans }}</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">{{ 'IP Management'|trans }}</li>
    </ol>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h3 class="card-title">{{ 'MAAS IP Management'|trans }}</h3>
    </div>
    <div class="card-body">
        {% if error %}
            <div class="alert alert-danger" role="alert">
                {{ error }}
            </div>
        {% else %}
            <div class="d-flex justify-content-between align-items-center">
                <h4 class="mt-4">{{ 'IP Addresses'|trans }}</h4>
                <a href="{{ 'servicemaas/ip/reserve'|alink }}" class="btn btn-primary">{{ 'Reserve IP'|trans }}</a>
            </div>
            <div class="table-responsive">
                <table class="table card-table table-vcenter text-nowrap datatable">
                    <thead>
                        <tr>
                            <th>{{ 'IP Address'|trans }}</th>
                            <th>{{ 'Status'|trans }}</th>
                            <th>{{ 'Owner'|trans }}</th>
                            <th>{{ 'Actions'|trans }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ip in ip_addresses %}
                            <tr>
                                <td>{{ ip.ip_address }}</td>
                                <td>{{ ip.status }}</td>
                                <td>{{ ip.owner }}</td>
                                <td>
                                    {% if ip.status == 'Reserved' %}
                                        <a class="btn btn-sm btn-secondary api-link" href="{{ 'api/admin/servicemaas/ip_release'|link({ 'ip': ip.ip_address, 'CSRFToken': CSRFToken }) }}" data-api-confirm="Are you sure?" data-api-redirect="{{ 'servicemaas/ip-management'|alink }}">Release</a>
                                    {% endif %}
                                </td>
                            </tr>
                        {% else %}
                            <tr>
                                <td colspan="4" class="text-center">{{ 'No IP addresses found.'|trans }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="d-flex justify-content-between align-items-center">
                <h4 class="mt-4">{{ 'Subnets'|trans }}</h4>
                <a href="{{ 'servicemaas/subnet/new'|alink }}" class="btn btn-primary">{{ 'Create Subnet'|trans }}</a>
            </div>
            <div class="table-responsive">
                <table class="table card-table table-vcenter text-nowrap datatable">
                    <thead>
                        <tr>
                            <th>{{ 'Name'|trans }}</th>
                            <th>{{ 'CIDR'|trans }}</th>
                            <th>{{ 'VLAN'|trans }}</th>
                            <th>{{ 'Gateway IP'|trans }}</th>
                            <th>{{ 'Actions'|trans }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for subnet in subnets %}
                            <tr>
                                <td>{{ subnet.name }}</td>
                                <td>{{ subnet.cidr }}</td>
                                <td>{{ subnet.vlan.name }} ({{ subnet.vlan.vid }})</td>
                                <td>{{ subnet.gateway_ip }}</td>
                                <td>
                                    <a class="btn btn-sm btn-primary" href="{{ 'servicemaas/subnet'|alink }}/{{ subnet.id }}">Edit</a>
                                    <a class="btn btn-sm btn-danger api-link" href="{{ 'api/admin/servicemaas/subnet_delete'|link({ 'id': subnet.id, 'CSRFToken': CSRFToken }) }}" data-api-confirm="Are you sure?" data-api-redirect="{{ 'servicemaas/ip-management'|alink }}">Delete</a>
                                </td>
                            </tr>
                        {% else %}
                            <tr>
                                <td colspan="5" class="text-center">{{ 'No subnets found.'|trans }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="d-flex justify-content-between align-items-center">
                <h4 class="mt-4">{{ 'IP Ranges'|trans }}</h4>
                <a href="{{ 'servicemaas/iprange/new'|alink }}" class="btn btn-primary">{{ 'Create IP Range'|trans }}</a>
            </div>
            <div class="table-responsive">
                <table class="table card-table table-vcenter text-nowrap datatable">
                    <thead>
                        <tr>
                            <th>{{ 'Type'|trans }}</th>
                            <th>{{ 'Start IP'|trans }}</th>
                            <th>{{ 'End IP'|trans }}</th>
                            <th>{{ 'Comment'|trans }}</th>
                            <th>{{ 'Actions'|trans }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for range in ip_ranges %}
                            <tr>
                                <td>{{ range.type }}</td>
                                <td>{{ range.start_ip }}</td>
                                <td>{{ range.end_ip }}</td>
                                <td>{{ range.comment }}</td>
                                <td>
                                    <a class="btn btn-sm btn-primary" href="{{ 'servicemaas/iprange'|alink }}/{{ range.id }}">Edit</a>
                                    <a class="btn btn-sm btn-danger api-link" href="{{ 'api/admin/servicemaas/iprange_delete'|link({ 'id': range.id, 'CSRFToken': CSRFToken }) }}" data-api-confirm="Are you sure?" data-api-redirect="{{ 'servicemaas/ip-management'|alink }}">Delete</a>
                                </td>
                            </tr>
                        {% else %}
                            <tr>
                                <td colspan="5" class="text-center">{{ 'No IP ranges found.'|trans }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
